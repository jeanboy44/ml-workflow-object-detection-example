---
marp: true
theme: default
size: 16:9
paginate: false
style: |
  section {
    /* 1. 내용을 위쪽부터 채우도록 강제 설정 (중요!) */
    display: flex;
    flex-direction: column;
    justify-content: flex-start; 

    /* 2. 제목이 들어갈 공간(150px) 확보 */
    padding-top: 200px;
    padding-left: 50px;
    padding-right: 50px;
    
    font-family: 'Malgun Gothic', sans-serif;
    font-size: 24px;
    background-color: white;
  }

  h1 {
    font-size: 48px;
    color: #002060;
    margin: 0;
    border: none;
    
    /* 위치 고정 */
    position: absolute;
    top: 50px;
    left: 50px; /* 좌측 여백도 맞춰주는 것이 좋습니다 */
    width: 90%; /* 제목이 길어질 경우를 대비 */
  }

  h2 {
    font-size: 24px;
    color: #666;
    margin: 0;
    
    /* 위치 고정 */
    position: absolute;
    top: 150px;
    left: 50px;
    width: 90%;
  }
---

# 실습 순서
- 데이터 이해 → 모델 학습 → 실험관리 → 배포 → 앱 검증
---

# 0. 환경 설정
- `uv` 설치 후 `uv sync`로 의존성 세팅 (`README.md`)
- `.env` 필요 시 설정
  - `DATABRICKS_HOST`, `DATABRICKS_TOKEN`, `KAGGLE_API_TOKEN`

```bash
uv sync
```

---

# 1. 실습 맛보기
- Streamlit 앱으로 전체 플로우 감 잡기
- 사전 학습 모델/MLflow 모델로 바로 추론 체험

```bash
uv run streamlit run apps/app.py
```

```bash
uv run streamlit run apps/object_detection_demo/main.py
```

---

# 2. 최신 모델 테스트하기
- 비교 관점: 정확도/속도/사용성
- 스크립트
  - DETR: `experiments/e01_detr_pre_trained_model.py`
  - YOLO: `experiments/e02_yolo_pre_trained_model.py`
  - GroundingDINO: `experiments/e00_grounddino_zero_shot_inference.py`

---

# 2-1. DETR 예시
```bash
uv run experiments/e01_detr_pre_trained_model.py \
  experiments/sample_data/ \
  --output-dir data/output_detr \
  --score-threshold 0.7
```

---

# 2-2. YOLO 예시
```bash
uv run experiments/e02_yolo_pre_trained_model.py \
  experiments/sample_data \
  --output-dir data/output_yolo26n/
```

---

# 2-3. GroundingDINO 예시
```bash
uv run experiments/e00_grounddino_zero_shot_inference.py \
  data/PCB_DATASET/images/Short/01_short_01.jpg \
  "circle" \
  --threshold 0.2 \
  --save-path data/output_ground_dino/01_short_01.jpg
```

---

# 3. 실습 문제 정의
<span class="badge">문제</span> PCB 불량탐지 비전 모델 개발
- 목적: 결함 클래스 탐지 정확도 향상
- 적용: 제조라인 검사 자동화
- 데이터: `data/PCB_DATASET` (Pascal VOC XML)

---

# 3-1. 데이터 설명
- 문서: `docs/PCB_DATASET 데이터 설명.md`
- 클래스 예시: Short, Open, Mousebite, Spur, Spurious Copper

---

# 4. 데이터 이해 (EDA)
- 클래스 분포 확인
- 바운딩 박스 크기/분포 확인
- 샘플 시각화로 난이도 파악

```bash
uv run experiments/e03_eda_pcb_data.py
```

---

# 5. YOLO 활용 학습 1
- 데이터 분할 → YOLO 포맷 변환
- Fast Run으로 파이프라인 검증

```bash
uv run experiments/exp05_train_yolo/split_pcb_dataset.py \
  --base-dir data/PCB_DATASET \
  --output-dir data/pcb_splits
```

```bash
uv run experiments/exp05_train_yolo/prepare_yolo_dataset.py \
  --split-dir data/pcb_splits \
  --output-dir data/pcb_yolo
```

---

# 5-1. Fast Run
```bash
uv run experiments/exp05_train_yolo/train_yolo.py \
  --data-yaml data/pcb_yolo/data.yaml \
  --model artifacts/yolo/yolo26n.pt \
  --epochs 5 \
  --imgsz 320 \
  --batch 2 \
  --fraction 0.01
```

---

# 6. YOLO 활용 학습 2
- Transfer Learning / From Scratch
- 고해상도 학습, Mosaic 실험

```bash
uv run experiments/exp05_train_yolo/train_yolo.py \
  --data-yaml data/pcb_yolo/data.yaml \
  --model artifacts/yolo/yolo26n.pt \
  --freeze-backbone 10 \
  --epochs 50 \
  --imgsz 640 \
  --batch 16
```

---

# 6-1. From Scratch / 고해상도
```bash
uv run experiments/exp05_train_yolo/train_yolo.py \
  --data-yaml data/pcb_yolo/data.yaml \
  --from-scratch \
  --epochs 80 \
  --imgsz 640 \
  --batch 16
```

```bash
uv run experiments/exp05_train_yolo/train_yolo.py \
  --data-yaml data/pcb_yolo/data.yaml \
  --model artifacts/yolo/yolo26n.pt \
  --epochs 10 \
  --imgsz 960 \
  --batch 8
```

---

# 7. MLflow로 실험 및 모델 관리하기
- Databricks MLflow Tracking 활용
- 실험 결과/모델 버전 관리

```bash
python scripts/register_yolo_model.py \
  my_yolo_model \
  runs/exp05/yolo_finetune/weights/best.pt
```

---

# 7-1. 레지스트리 모델 예측
```bash
python scripts/predict_with_registered_model.py \
  my_yolo_model \
  data/PCB_DATASET/images/Short/01_short_01.jpg
```

---

# 8. 모델 배포하기
- ONNX 변환 → 성능/정합성 확인

```bash
python scripts/convert_pt_to_onnx.py \
  runs/exp05/yolo_finetune/weights/best.pt \
  --output-dir artifacts/onnx \
  --sample-dir experiments/data_sample
```

---

# 8-1. PT vs ONNX 벤치마크
```bash
python scripts/benchmark_models.py \
  runs/exp05/yolo_finetune/weights/best.pt \
  artifacts/onnx/best.onnx \
  data/PCB_DATASET/images/Short
```

---

# 9. Streamlit 앱에서 내 모델 확인하기
- MLflow 등록 모델을 앱에 연결
- 실사용 UI 기준으로 검증

```bash
streamlit run apps/object_detection_demo/main.py
```

---

# 마무리
- 데이터 → 학습 → 실험관리 → 배포 → 앱검증까지 전 단계 경험
- 다음 단계: 하이퍼파라미터 최적화, 고해상도 학습, 실서비스 배포
